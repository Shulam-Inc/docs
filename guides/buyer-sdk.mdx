---
title: "Client SDK Guide"
description: "Integrate Shulam payments in your frontend or agent"
---

# Client SDK Guide

The `@shulam/x402` package provides client-side tools for paying through x402 paywalls automatically.

## Installation

```bash
npm install @shulam/x402 viem
```

## Auto-402 Client

The `createShulamClient` function returns a fetch-compatible client that automatically handles HTTP 402 responses — it signs the payment, submits it, and retries the request.

```typescript
import { createShulamClient } from "@shulam/x402/client";

const client = createShulamClient({
  facilitatorUrl: "https://api.shulam.io",
  signer: walletSigner,         // viem WalletClient or private key
  walletAddress: "0xBuyerAddress",
  maxPaymentUSDC: 100,           // max per-request limit
});

// Fetch a paid resource — 402 is handled transparently
const response = await client.fetch("https://api.merchant.com/premium-data");
const data = await response.json();
```

### Configuration

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `facilitatorUrl` | `string` | Yes | Shulam facilitator endpoint |
| `signer` | `WalletClient \| Hex` | Yes | Wallet signer or private key |
| `walletAddress` | `string` | Yes | Buyer's wallet address |
| `maxPaymentUSDC` | `number` | Yes | Max USDC per request |

### How It Works

1. `client.fetch(url)` sends a normal GET/POST request
2. If the server returns HTTP 402 with payment details, the client signs an EIP-3009 authorization
3. The client resubmits the request with the `X-PAYMENT` header
4. The server verifies and settles, then returns the resource

## React Hook

The `useShulamPayment` hook provides a React-friendly interface.

```tsx
import { useShulamPayment } from "@shulam/x402/react";

function PremiumContent() {
  const { pay, paying, lastReceipt, error, dailySpending, reset } = useShulamPayment({
    facilitatorUrl: "https://api.shulam.io",
    signer: walletSigner,
    walletAddress: "0xBuyerAddress",
    maxDailyUSDC: 50,
  });

  const handleAccess = async () => {
    const response = await pay("https://api.merchant.com/premium");
    const data = await response.json();
  };

  return (
    <div>
      <button onClick={handleAccess} disabled={paying}>
        {paying ? "Paying..." : "Access Premium Content"}
      </button>

      {lastReceipt && <p>Last TX: {lastReceipt.txHash}</p>}
      {error && <p>Error: {error.message}</p>}
      <p>Daily spending: {dailySpending} USDC</p>
    </div>
  );
}
```

### Hook Return Values

| Property | Type | Description |
|----------|------|-------------|
| `pay` | `(url: string) => Promise<Response>` | Fetch with auto-402 handling |
| `paying` | `boolean` | True while payment is in progress |
| `lastReceipt` | `Receipt \| null` | Last payment receipt (`txHash`, `payer`, `amount`) |
| `error` | `Error \| null` | Last error, if any |
| `dailySpending` | `string` | Total USDC spent today |
| `reset` | `() => void` | Reset error and receipt state |

## Multi-Endpoint Server

For merchants with multiple paid endpoints, use `createShulamServer`:

```typescript
import { createShulamServer } from "@shulam/x402/server";

const shulam = createShulamServer({
  facilitatorUrl: "https://api.shulam.io",
  sellerAddress: "0xMerchantWallet",
  endpoints: {
    "/api/basic": { amount: "1000000" },   // 1 USDC
    "/api/premium": { amount: "10000000" }, // 10 USDC
    "/api/bulk": { amount: "50000000" },    // 50 USDC
  },
});
```

## Error Handling

```typescript
import { createShulamClient } from "@shulam/x402/client";

const client = createShulamClient({ /* config */ });

try {
  const response = await client.fetch("https://api.merchant.com/data");
  const data = await response.json();
} catch (error) {
  if (error.code === "INSUFFICIENT_BALANCE") {
    // Buyer doesn't have enough USDC
  } else if (error.code === "PAYMENT_REJECTED") {
    // Facilitator rejected the payment (compliance hold, etc.)
  } else if (error.code === "MAX_PAYMENT_EXCEEDED") {
    // Request exceeds maxPaymentUSDC limit
  }
}
```
